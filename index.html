<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Countdown</title>
<style>
  :root{
    --border: rgba(0,0,0,.15);
    --text: #000000;
    --neon-yellow: #FFEE00;
    --neon-orange: #FF6A00;
    --neon-red:    #FF0033;
    /* reusable black outline for text-shadow fallback */
    --outline: -1px 0 0 #000, 1px 0 0 #000, 0 -1px 0 #000, 0 1px 0 #000;
  }
  @media (prefers-color-scheme: dark){
    :root{
      --border: rgba(255,255,255,.18);
      --text: #eaeaea;
    }
  }

  html,body{
    margin:0;
    background:transparent;               /* blank page background */
    color:var(--text);
    font-family: ui-sans-serif, system-ui, "Segoe UI", Arial;
  }

  .card{
    display:inline-block;
    padding:12px;
    border:1px solid var(--border);
    border-radius:14px;
    background:transparent;               /* no fill until the red flash */
    transition: background .2s ease, box-shadow .2s ease;
  }

  .row{display:flex; align-items:center; justify-content:space-between; gap:12px;}
  .time{
    font-size:44px; font-weight:800; letter-spacing:.5px;
    color:#000;                                /* starts black */
    /* crisp black outline in modern browsers */
    -webkit-text-stroke: 2px #000;
    text-stroke: 2px #000;
    -webkit-text-fill-color: currentColor;
    /* fallback outline for older browsers using text-shadow */
    text-shadow: var(--outline);
  }
  .status{font-size:12px; color:#666; margin-top:4px}
  .btn{
    padding:8px 12px; border-radius:10px; cursor:pointer;
    border:1px solid var(--neon-red); background:var(--neon-red); color:#fff;
  }
  .btn:hover{ filter:brightness(.92); }

  .bar{height:8px; background:rgba(0,0,0,.08); border-radius:999px; overflow:hidden; margin-top:12px; border:1px solid var(--border)}
  .bar>div{height:100%; width:0%; background:#000}

  /* Neon glows keep the black outline by including --outline first */
  .glow-yellow{ text-shadow: var(--outline), 0 0 6px var(--neon-yellow), 0 0 14px var(--neon-yellow), 0 0 24px rgba(255,238,0,.8); }
  .glow-orange{ text-shadow: var(--outline), 0 0 6px var(--neon-orange), 0 0 14px var(--neon-orange), 0 0 24px rgba(255,106,0,.8); }
  .glow-red{    text-shadow: var(--outline), 0 0 6px var(--neon-red),    0 0 16px var(--neon-red),    0 0 28px rgba(255,0,51,.9); }

  /* Intense red flash last minute */
  @keyframes flash-red {
    0%   { background: transparent; box-shadow: 0 0 0 0 rgba(255,0,51,0); }
    50%  { background: rgba(255,0,51,0.88); box-shadow: 0 0 36px 12px rgba(255,0,51,0.78); }
    100% { background: transparent; box-shadow: 0 0 0 0 rgba(255,0,51,0); }
  }
  .blink { animation: flash-red 0.9s linear infinite; border-color: var(--neon-red) !important; }

  @media (prefers-reduced-motion: reduce){
    .blink { animation: none; background: rgba(255,0,51,0.88); box-shadow: 0 0 24px 10px rgba(255,0,51,0.7); }
  }
</style>
</head>
<body>
  <div class="card" id="card">
    <div class="row">
      <div>
        <div id="display" class="time">10:00</div>
        <div id="status" class="status">Running</div>
      </div>
      <div style="display:flex; gap:8px">
        <button id="restart" class="btn">Restart</button>
      </div>
    </div>
    <div class="bar" aria-hidden="true"><div id="barfill"></div></div>
  </div>

<script>
(function () {
  // URL params: ?m=10 (minutes) or ?s=600 (seconds), ?beep=1|0
  const p = new URLSearchParams(location.search);
  const m = parseInt(p.get('m') || '10', 10);
  const sOverride = parseInt(p.get('s') || '0', 10);
  const totalSeconds = Number.isFinite(sOverride) && sOverride > 0 ? sOverride : m * 60;
  const doBeep = (p.get('beep') ?? '1') !== '0';

  const displayEl = document.getElementById('display');
  const statusEl  = document.getElementById('status');
  const btn       = document.getElementById('restart');
  const barFill   = document.getElementById('barfill');
  const cardEl    = document.getElementById('card');

  const cs = getComputedStyle(document.documentElement);
  const NEON = {
    yellow: cs.getPropertyValue('--neon-yellow').trim() || '#FFEE00',
    orange: cs.getPropertyValue('--neon-orange').trim() || '#FF6A00',
    red:    cs.getPropertyValue('--neon-red').trim()    || '#FF0033'
  };

  // Thresholds
  const YELLOW_AT = 7 * 60;
  const ORANGE_AT = 5 * 60;
  const RED_AT    = 2.5 * 60;
  const BLINK_AT  = 60;

  let endTs, timerId, done = false;

  function pad(n){ return String(n).padStart(2,'0'); }
  function fmt(sec){
    sec = Math.max(0, Math.floor(sec));
    const mm = Math.floor(sec / 60), ss = sec % 60;
    return `${pad(mm)}:${pad(ss)}`;
  }

  function clearGlows(){
    displayEl.classList.remove('glow-yellow','glow-orange','glow-red');
  }

  function start(){
    endTs = Date.now() + totalSeconds * 1000;
    done = false;
    statusEl.textContent = 'Running';
    cardEl.classList.remove('blink');
    clearGlows();
    displayEl.style.color = '#000';          // start black
    barFill.style.background = '#000';       // neutral bar
    tick();
    if (timerId) clearInterval(timerId);
    timerId = setInterval(tick, 250);
  }

  function beep(){
    if (!doBeep) return;
    try{
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = 'sine'; osc.frequency.setValueAtTime(880, ctx.currentTime);
      gain.gain.setValueAtTime(0.001, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.25, ctx.currentTime + 0.01);
      gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.45);
      osc.connect(gain); gain.connect(ctx.destination);
      osc.start(); osc.stop(ctx.currentTime + 0.5);
    }catch(e){}
  }

  function tick(){
    const now = Date.now();
    let remainingMs = endTs - now;

    if (remainingMs <= 0){
      if (!done){
        done = true;
        displayEl.textContent = '00:00';
        statusEl.textContent = 'Completed';
        clearInterval(timerId);
        cardEl.classList.remove('blink');
        clearGlows();
        displayEl.style.color = NEON.red;
        displayEl.classList.add('glow-red');
        barFill.style.width = '100%';
        barFill.style.background = NEON.red;
        beep();
      }
      return;
    }

    const remainingSec = remainingMs / 1000;
    displayEl.textContent = fmt(remainingSec);

    // Progress bar (fill increases with elapsed)
    const elapsed = totalSeconds - remainingSec;
    const pct = Math.min(100, Math.max(0, (elapsed / totalSeconds) * 100));
    barFill.style.width = pct.toFixed(2) + '%';

    // Number colour phases (neon + always-outlined)
    clearGlows();
    if (remainingSec <= RED_AT){
      displayEl.style.color = NEON.red;
      displayEl.classList.add('glow-red');
      barFill.style.background = NEON.red;
    } else if (remainingSec <= ORANGE_AT){
      displayEl.style.color = NEON.orange;
      displayEl.classList.add('glow-orange');
      barFill.style.background = NEON.orange;
    } else if (remainingSec <= YELLOW_AT){
      displayEl.style.color = NEON.yellow;
      displayEl.classList.add('glow-yellow');
      barFill.style.background = NEON.yellow;
    } else {
      displayEl.style.color = '#000';         // black early
      barFill.style.background = '#000';
    }

    // Intense red strobe last minute
    if (remainingSec <= BLINK_AT){
      cardEl.classList.add('blink');
    } else {
      cardEl.classList.remove('blink');
    }
  }

  btn.addEventListener('click', start);
  start();
  window.addEventListener('beforeunload', () => { if (timerId) clearInterval(timerId); });
})();
</script>
</body>
</html>
